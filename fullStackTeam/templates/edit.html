{% extends "master.html" %}

{% block title %}Edit team member{% endblock %}

{% block content %}
    <h1>Edit team member</h1>
    <div class="subtitle">Edit contact info and role.</div>

    <form method="POST">
        {% csrf_token %}
        <h3>Info</h3>
        <input type="text" name="first_name" value="{{ mymember.first_name }}" required>
        <input type="text" name="last_name" value="{{ mymember.last_name }}" required>
        <input type="email" name="email" value="{{ mymember.email }}" required>
        <input type="tel" name="phone" id="phone" value="{{ mymember.phone }}" required 
            pattern="\(\d{3}\)\s\d{3}-\d{4}" 
            oninput="formatPhoneNumber(this)">

        <h3>Role</h3>
        <div class="role-selector">
            <label class="role-option">
                <input type="radio" name="role" value="Regular" {% if mymember.role == 'Regular' %}checked{% endif %}>
                Regular - Can't delete members
            </label>
            <label class="role-option">
                <input type="radio" name="role" value="Admin" {% if mymember.role == 'Admin' %}checked{% endif %}>
                Admin - Can delete members
            </label>
        </div>

        <button type="submit" name="delete" class="delete-button">Delete</button>
        <button type="submit" class="save-button">Save</button>
    </form>
    <script>
        function formatPhoneNumber(input) {
            // Remove all non-digit characters
            let value = input.value.replace(/\D/g, '');
            
            // Limit to 10 digits
            value = value.substring(0, 10);
            
            // Format the number
            if (value.length >= 6) {
                value = `(${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6)}`;
            } else if (value.length >= 3) {
                value = `(${value.substring(0, 3)}) ${value.substring(3)}`;
            } else if (value.length > 0) {
                value = `(${value}`;
            }
            
            input.value = value;
        }

        function validateForm() {
            if (event.submitter.name === 'delete') {
                return true; // Skip validation for delete button
            }
            
            const phone = document.getElementById('phone').value;
            const phonePattern = /^\(\d{3}\)\s\d{3}-\d{4}$/;
            
            if (!phonePattern.test(phone)) {
                alert('Please enter a valid phone number in the format (XXX) XXX-XXXX');
                return false;
            }
            return true;
        }

        // Format the phone number on page load
        window.onload = function() {
            const phoneInput = document.getElementById('phone');
            formatPhoneNumber(phoneInput);
        }
    </script>
{% endblock %}